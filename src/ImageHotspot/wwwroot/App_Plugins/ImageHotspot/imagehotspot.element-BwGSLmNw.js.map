{"version":3,"file":"imagehotspot.element-BwGSLmNw.js","sources":["../../../Client/src/editors/imagehotspot.element.ts"],"sourcesContent":["import { customElement, html, css, property, state } from \"@umbraco-cms/backoffice/external/lit\";\r\nimport { UmbLitElement } from \"@umbraco-cms/backoffice/lit-element\";\r\nimport { UmbPropertyValueChangeEvent } from \"@umbraco-cms/backoffice/property-editor\";\r\nimport type { ImageHotspotValue } from \"../types/imagehotspotvalue\";\r\nimport type { UmbPropertyEditorConfigCollection, UmbPropertyEditorUiElement } from '@umbraco-cms/backoffice/property-editor';\r\nimport { UMB_DOCUMENT_WORKSPACE_CONTEXT, UmbDocumentWorkspaceContext } from \"@umbraco-cms/backoffice/document\";\r\nimport { UmbDocumentDetailRepository } from \"@umbraco-cms/backoffice/document\";\r\nimport { UmbDocumentItemRepository } from \"@umbraco-cms/backoffice/document\";\r\nimport { UmbMediaDetailRepository } from \"@umbraco-cms/backoffice/media\";\r\nimport { UmbEntityUnique } from \"@umbraco-cms/backoffice/entity\";\r\nimport { UmbElementDetailModel } from \"@umbraco-cms/backoffice/content\";\r\n\r\n@customElement(\"image-hotspot\")\r\nexport class ImageHotspot extends UmbLitElement implements UmbPropertyEditorUiElement {\r\n\r\n  static properties = {\r\n    value: { type: Object },\r\n    config: { type: Object },\r\n  }\r\n\r\n  @state()\r\n  private _config?: UmbPropertyEditorConfigCollection;\r\n\r\n  @state()\r\n  private _imgSrc?: string;\r\n\r\n  @state()\r\n  private _imgWidth: number = 400;\r\n\r\n  @state()\r\n  private _imgHeight: number = 0;\r\n\r\n  @state()\r\n  private _imgTheme?: number;\r\n\r\n  @property({ attribute: false })\r\n  public set config(config: UmbPropertyEditorConfigCollection) {\r\n    this._config = config;\r\n    this.#setConfig();\r\n  };\r\n\r\n  @property({ attribute: false })\r\n  value: ImageHotspotValue = {\r\n    image: null,\r\n    width: null,\r\n    height: null,\r\n    percentX: null,\r\n    percentY: null,\r\n    left: null,\r\n    top: null,\r\n  };\r\n\r\n  #documentWorkspaceContext?: UmbDocumentWorkspaceContext;\r\n  #documentDetailRepository = new UmbDocumentDetailRepository(this);\r\n  #documentItemRepository = new UmbDocumentItemRepository(this);\r\n  #mediaDetailRepository = new UmbMediaDetailRepository(this);\r\n\r\n  #onClick(event: MouseEvent) {\r\n    this.#setPosition(event.offsetX, event.offsetY);\r\n  }\r\n\r\n  #onDragEnd(event: DragEvent) {\r\n    if (event.dataTransfer && this.value.left && this.value.top) {\r\n      const left = this.value.left + event.offsetX - ((event.target as HTMLElement)?.clientWidth / 2);\r\n      const top = this.value.top + event.offsetY - ((event.target as HTMLElement)?.clientHeight / 2);\r\n      this.#setPosition(left, top);\r\n    }\r\n  }\r\n\r\n  #setPosition(x: number, y: number) {\r\n    this.value = {\r\n      left: x,\r\n      top: y,\r\n      percentX: x / this._imgWidth,\r\n      percentY: y / this._imgHeight,\r\n      width: this._imgWidth,\r\n      height: this._imgHeight,\r\n      image: this._imgSrc\r\n    };\r\n    this.dispatchEvent(new UmbPropertyValueChangeEvent());\r\n    this.requestUpdate();\r\n  }\r\n\r\n  async #setConfig() {\r\n    if (this._config && this.#documentWorkspaceContext) {\r\n\r\n      const imagePropertyAlias = this._config.getValueByAlias(\"imageSrc\")?.toString();\r\n      let imageValue = imagePropertyAlias ? this.#documentWorkspaceContext.getPropertyValue<Array<any>>(imagePropertyAlias) : null;\r\n\r\n      if (imagePropertyAlias && !imageValue) {\r\n        imageValue = await this.#getValueFromUnique(this.#documentWorkspaceContext.getUnique(), imagePropertyAlias);\r\n      }\r\n\r\n      if (imageValue && typeof imageValue === 'object') {\r\n        let firstImageValue = imageValue[0];\r\n\r\n        const media = await this.#mediaDetailRepository.requestByUnique(firstImageValue?.mediaKey);\r\n        this._imgSrc = media?.data?.urls[0].url;\r\n        const mediaWidth = this.#getPropertyValue(\"umbracoWidth\", media?.data) || 0;\r\n        const mediaHeight = this.#getPropertyValue(\"umbracoHeight\", media?.data) || 0;\r\n        this._imgWidth = this._config.getValueByAlias(\"width\") || 400;\r\n        this._imgHeight = this._imgWidth * mediaHeight / mediaWidth;\r\n      }\r\n\r\n      const theme = this._config.getValueByAlias(\"theme\") || \"Red\";\r\n      switch (theme) {\r\n        case \"Red\":\r\n          this._imgTheme = 1;\r\n          break;\r\n        case \"Green\":\r\n          this._imgTheme = 2;\r\n          break;\r\n        case \"Blue\":\r\n          this._imgTheme = 3;\r\n          break;\r\n        case \"Orange\":\r\n          this._imgTheme = 4;\r\n          break;\r\n        default:\r\n          this._imgTheme = 1;\r\n          break;\r\n      }\r\n    }\r\n  }\r\n\r\n  async #getParentFromUnique(unique: string | undefined | null) : Promise<UmbEntityUnique | undefined> {\r\n    if (unique) {\r\n      const parent = await this.#documentItemRepository.requestItems([unique]);\r\n      const parentUnique = parent?.data ? parent?.data[0]?.parent?.unique : undefined;\r\n      return parentUnique;\r\n    }\r\n    return undefined;\r\n  }\r\n\r\n  async #getValueFromUnique(unique: UmbEntityUnique | undefined | null, alias: string): Promise<Array<any> | null> {\r\n    if (unique) {\r\n      const item = await this.#documentDetailRepository.requestByUnique(unique);\r\n      const value = this.#getPropertyValue(alias, item?.data);\r\n      return value as Array<any> || await this.#getValueFromUnique(await this.#getParentFromUnique(unique), alias);\r\n    }\r\n\r\n    return null;\r\n  }\r\n\r\n  #getPropertyValue(alias: string, item: UmbElementDetailModel | undefined): any {\r\n    if (!item) {\r\n      return null;\r\n    }\r\n\r\n    const value = item?.values.find((i) => i.alias === alias);\r\n    if (value) {\r\n      return value.value;\r\n    }\r\n    return null;\r\n  }\r\n\r\n  connectedCallback() {\r\n    super.connectedCallback();\r\n    this.consumeContext(UMB_DOCUMENT_WORKSPACE_CONTEXT, (context) => {\r\n      this.#documentWorkspaceContext = context;\r\n      this.#setConfig();\r\n    });\r\n  }\r\n  constructor() {\r\n    super();\r\n\r\n  }\r\n\r\n  render() {\r\n    return html`\r\n      <div class=\"imagehotspot-editor theme${this._imgTheme}\">\r\n        <div class=\"imagehotspot-image\" @click=\"${this.#onClick}\">\r\n          ${this._imgSrc\r\n        ? html`\r\n              <img src=\"${this._imgSrc}?width=${this._imgWidth}\" srcset=\"${this._imgSrc}?width=${(this._imgWidth || 0) * 2} 2x\" width=\"${this._imgWidth || 0}\" height=\"${this._imgHeight || 0}\" />\r\n            `\r\n        : html`\r\n              <div class=\"imagehotspot-placeholder-image\"></div>\r\n            `\r\n      }\r\n          ${this.value?.left && this.value?.top\r\n        ? html`\r\n              <div id=\"imagehotspot-hotspot\" class=\"imagehotspot-hotspot\" draggable=\"true\" @dragend=\"${this.#onDragEnd}\" style=\"left:${this.value.left}px;top:${this.value.top}px;\"></div>\r\n            `\r\n        : ''\r\n      }\r\n        </div>\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  static styles = css`\r\n    .imagehotspot-editor {\r\n      border: 1px solid #bbbabf;\r\n      display: inline-block;\r\n      line-height: 0;\r\n    }\r\n\r\n    .imagehotspot-image {\r\n      position: relative;\r\n      display: inline-block;\r\n      cursor: crosshair;\r\n    }\r\n\r\n    .imagehotspot-hotspot {\r\n      background: rgba(0, 0, 0, 0.5);\r\n      position: absolute;\r\n      width: 21px;\r\n      height: 21px;\r\n      border-radius: 50%;\r\n      border: 3px solid #fff;\r\n      opacity: 0.8;\r\n      transform: translate(-50%, -50%);\r\n      cursor: move;\r\n    }\r\n\r\n    .imagehotspot-placeholder-image {\r\n      display: block;\r\n      width: 400px;\r\n      height: 300px;\r\n      border: 1px solid #999;\r\n      background: rgba(0, 0, 0, 0.1);\r\n    }\r\n\r\n    .theme1 .imagehotspot-hotspot { background: rgb(223, 59, 58); }\r\n    .theme2 .imagehotspot-hotspot { background: rgb(100, 189, 99); }\r\n    .theme3 .imagehotspot-hotspot { background: rgb(54, 180, 246); }\r\n    .theme4 .imagehotspot-hotspot { background: rgb(239, 144, 0); }\r\n  `;\r\n}\r\n\r\nexport default ImageHotspot;\r\n\r\n\r\ndeclare global {\r\n  interface HTMLElementTagNameMap {\r\n    'image-hotspot': ImageHotspot;\r\n  }\r\n}\r\n"],"names":["_documentWorkspaceContext","_documentDetailRepository","_documentItemRepository","_mediaDetailRepository","_ImageHotspot_instances","onClick_fn","onDragEnd_fn","setPosition_fn","setConfig_fn","getParentFromUnique_fn","getValueFromUnique_fn","getPropertyValue_fn","ImageHotspot","UmbLitElement","__privateAdd","UmbDocumentDetailRepository","UmbDocumentItemRepository","UmbMediaDetailRepository","config","__privateMethod","UMB_DOCUMENT_WORKSPACE_CONTEXT","context","__privateSet","html","_a","_b","event","left","top","x","y","UmbPropertyValueChangeEvent","__privateGet","imagePropertyAlias","imageValue","firstImageValue","media","mediaWidth","mediaHeight","unique","parent","alias","item","value","i","css","__decorateClass","state","property","customElement","ImageHotspot$1"],"mappings":"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"}